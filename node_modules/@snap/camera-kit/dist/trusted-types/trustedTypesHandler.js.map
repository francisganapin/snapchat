{"version":3,"file":"trustedTypesHandler.js","sourceRoot":"","sources":["../../src/trusted-types/trustedTypesHandler.ts"],"names":[],"mappings":"AAMA,MAAM,QAAQ,GAAG,IAAI,GAAG,EAA+B,CAAC;AAcxD,MAAM,UAAU,sBAAsB,CAAC,sBAA8B;IACjE,MAAM,MAAM,GAAG,QAAQ,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;IACpD,IAAI,MAAM;QAAE,OAAO,MAAM,CAAC;IAE1B,MAAM,OAAO,GAAG,aAAa,CAAC,sBAAsB,CAAC,CAAC;IACtD,QAAQ,CAAC,GAAG,CAAC,sBAAsB,EAAE,OAAO,CAAC,CAAC;IAC9C,OAAO,OAAO,CAAC;AACnB,CAAC;AAED,SAAS,aAAa,CAAC,sBAA8B;IACjD,MAAM,WAAW,GAAG,IAAI,GAAG,EAAU,CAAC;IACtC,MAAM,YAAY,GAA0C,UAAkB,CAAC,YAAY,CAAC;IAC5F,MAAM,MAAM,GAAG,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,YAAY,CAAC,sBAAsB,EAAE;QAC9D,eAAe,EAAE,CAAC,GAAW,EAAE,EAAE;YAC7B,IAAI,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC;gBAAE,OAAO,GAAG,CAAC;YACrC,MAAM,IAAI,SAAS,CAAC,4BAA4B,GAAG,GAAG,CAAC,CAAC;QAC5D,CAAC;KACJ,CAAC,CAAC;IACH,OAAO;QACH,UAAU,EAAE,sBAAsB;QAClC,cAAc,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,WAAW,CAAC;QACtC,QAAQ,EAAE,CAAC,GAAW,EAAE,EAAE;;YACtB,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACrB,OAAO,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,eAAe,CAAC,GAAG,CAAC,mCAAI,GAAG,CAAC;QAC/C,CAAC;KACJ,CAAC;AACN,CAAC","sourcesContent":["export interface TrustedTypesHandler {\n    policyName: string;\n    getTrustedUrls: () => string[];\n    trustUrl: (url: string) => string | TrustedScriptURL;\n}\n\nconst handlers = new Map<string, TrustedTypesHandler>();\n\n/**\n * Returns a Trusted Types handler for the given policy name.\n * If a handler for the given policy name already exists, it is returned.\n * Otherwise, a new handler is created and cached.\n *\n * Trusted Types policies exist on the window realm and duplicate policy names are not allowed.\n * When bootstrapCameraKit is called multiple times with the same trustedTypesPolicyName during\n * a window lifecycle, we reuse the cached handler instead of attempting to create a duplicate policy.\n *\n * @param trustedTypesPolicyName - The name of the Trusted Types policy to use.\n * @returns A Trusted Types handler for the given policy name.\n */\nexport function getTrustedTypesHandler(trustedTypesPolicyName: string) {\n    const cached = handlers.get(trustedTypesPolicyName);\n    if (cached) return cached;\n\n    const handler = createHandler(trustedTypesPolicyName);\n    handlers.set(trustedTypesPolicyName, handler);\n    return handler;\n}\n\nfunction createHandler(trustedTypesPolicyName: string) {\n    const trustedUrls = new Set<string>();\n    const trustedTypes: TrustedTypePolicyFactory | undefined = (globalThis as any).trustedTypes;\n    const policy = trustedTypes?.createPolicy(trustedTypesPolicyName, {\n        createScriptURL: (url: string) => {\n            if (trustedUrls.has(url)) return url;\n            throw new TypeError(\"Blocked by Trusted Types: \" + url);\n        },\n    });\n    return {\n        policyName: trustedTypesPolicyName,\n        getTrustedUrls: () => [...trustedUrls],\n        trustUrl: (url: string) => {\n            trustedUrls.add(url);\n            return policy?.createScriptURL(url) ?? url;\n        },\n    };\n}\n"]}